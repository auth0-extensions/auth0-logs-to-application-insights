module.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="/build/",t(0)}([function(e,t,n){(function(t){"use strict";"use latest";function i(e,n){var i=e.webtaskContext;return i.data.AUTH0_DOMAIN&&i.data.AUTH0_GLOBAL_CLIENT_ID&&i.data.AUTH0_GLOBAL_CLIENT_SECRET?i.data.APPINSIGHTS_INSTRUMENTATIONKEY?void e.webtaskContext.storage.get(function(a,l){var c="undefined"==typeof l?null:l.checkpointId;console.log("Starting from:",c);var p=u(i.data.APPINSIGHTS_INSTRUMENTATIONKEY);p.commonProperties={auth0_domain:i.data.AUTH0_DOMAIN};var v=new o({domain:i.data.AUTH0_DOMAIN,clientID:i.data.AUTH0_GLOBAL_CLIENT_ID,clientSecret:i.data.AUTH0_GLOBAL_CLIENT_SECRET}),f=function(e){v.getAccessToken(function(t,n){return console.log("Authenticating..."),t?(console.log("Error authenticating",t),e(t)):(console.log("Authentication success."),e())})},g=[],m=function _(e,n){v.getLogs({take:200,from:e},function(i,o){return i?console.log("Error getting logs:",i.message):o&&o.length>0?(o.forEach(function(e){e.date&&s().diff(s(e.date),"hours")<48&&g.push(e)}),console.log("Retrieved "+g.length+" logs from Auth0 after "+e+"."),t(function(){c=o[o.length-1]._id,_(o[o.length-1]._id,n)}),void 0):(console.log("Reached end of logs. Total: "+g.length+"."),n(null,g))})},h=function(e,t){return console.log("Exporting logs to Application Insights: "+e.length),e.forEach(function(e){var t=0;e.type_code=e.type,d[e.type]&&(t=d[e.type].level,e.type=d[e.type].event),e.ip&&""!==e.ip||delete e.ip,e.user_id&&""!==e.user_id||delete e.user_id,e.user_name&&""!==e.user_name||delete e.user_name,e.connection&&""!==e.connection||delete e.connection,e.client_name&&""!==e.client_name||delete e.client_name,e.description&&""!==e.description||delete e.description,e.isMobile=e.isMobile&&"yes"||"no",e.details&&(e.details=JSON.stringify(e.details,null,2)),e.details&&e.details.length>8185&&(e.details=e.details.substring(0,8185)+"...");var n=r.parse(e.user_agent);if(e.os=n.os.toString(),e.os_version=n.os.toVersion(),e.device=n.device.toString(),e.device_version=n.device.toVersion(),e.device&&e.device.indexOf("Generic Smartphone")>=0&&(e.device=n.os.toString(),e.device_version=n.os.toVersion()),t>=3){var i=new Error(e.type);i.name=e.type,p.trackException(i,e)}p.trackEvent(e.type,e)}),e&&e.length?(console.log("Flushing all data..."),void p.sendPendingData(function(e){return t(null,e)})):(console.log("No data to flush..."),t(null,'{ "itemsAccepted": 0 }'))};f(function(t){return t?n.status(500).send({err:t}):void m(c,function(t,i){return i?void h(i,function(t,i){try{i=JSON.parse(i)}catch(o){return console.log("Error parsing response, this might indicate that an error occurred:",i),e.webtaskContext.storage.set({checkpointId:c},{force:1},function(e){return e?n.status(500).send(e):void n.status(500).send({error:i})})}return i.itemsAccepted&&i.itemsAccepted>0?e.webtaskContext.storage.set({checkpointId:c},{force:1},function(e){return e?n.status(500).send(e):void n.sendStatus(200)}):(console.log("No items accepted."),e.webtaskContext.storage.set({checkpointId:c},{force:1},function(e){return e?n.status(500).send(e):void n.sendStatus(200)}))}):n.status(500).send({err:t})})})}):n.status(400).send({message:"Application Insights instrumentation key is missing."}):n.status(400).send({message:"Auth0 API v1 credentials or domain missing."})}var o=n(3),r=n(4),s=n(5),a=n(6),l=n(7),c=a(),u=function(e){var t=n(10),i=t.getClient(e),o=i.getEnvelope;return i.getEnvelope=function(e,t){var n=o.apply(i,[e,t]);return n.time=e.baseData.properties.date,n.os=e.baseData.properties.os,n.osVer=e.baseData.properties.os_version,n.tags["ai.device.id"]=e.baseData.properties.device,n.tags["ai.device.machineName"]="",n.tags["ai.device.type"]="mobile:"+e.baseData.properties.isMobile,n.tags["ai.device.os"]=e.baseData.properties.os,n.tags["ai.device.osVersion"]=e.baseData.properties.os_version,n.tags["ai.device.osArchitecture"]="",n.tags["ai.device.osPlatform"]=e.baseData.properties.os,e.baseData.properties.ip&&(n.tags["ai.location.ip"]=e.baseData.properties.ip),(e.baseData.properties.user_id||e.baseData.properties.user_name)&&(n.tags["ai.user.id"]=e.baseData.properties.user_id||e.baseData.properties.user_name,n.tags["ai.user.accountId"]=e.baseData.properties.user_id||e.baseData.properties.user_name,n.tags["ai.user.authUserId"]=e.baseData.properties.user_id||e.baseData.properties.user_name),e.baseData.properties.user_agent&&(n.tags["ai.user.userAgent"]=e.baseData.properties.user_agent),n},i},d={s:{event:"Success Login",level:1},seacft:{event:"Success Exchange",level:1},feacft:{event:"Failed Exchange",level:3},f:{event:"Failed Login",level:3},w:{event:"Warnings During Login",level:2},du:{event:"Deleted User",level:1},fu:{event:"Failed Login (invalid email/username)",level:3},fp:{event:"Failed Login (wrong password)",level:3},fc:{event:"Failed by Connector",level:3},fco:{event:"Failed by CORS",level:3},con:{event:"Connector Online",level:1},coff:{event:"Connector Offline",level:3},fcpro:{event:"Failed Connector Provisioning",level:4},ss:{event:"Success Signup",level:1},fs:{event:"Failed Signup",level:3},cs:{event:"Code Sent",level:0},cls:{event:"Code/Link Sent",level:0},sv:{event:"Success Verification Email",level:0},fv:{event:"Failed Verification Email",level:0},scp:{event:"Success Change Password",level:1},fcp:{event:"Failed Change Password",level:3},sce:{event:"Success Change Email",level:1},fce:{event:"Failed Change Email",level:3},scu:{event:"Success Change Username",level:1},fcu:{event:"Failed Change Username",level:3},scpn:{event:"Success Change Phone Number",level:1},fcpn:{event:"Failed Change Phone Number",level:3},svr:{event:"Success Verification Email Request",level:0},fvr:{event:"Failed Verification Email Request",level:3},scpr:{event:"Success Change Password Request",level:0},fcpr:{event:"Failed Change Password Request",level:3},fn:{event:"Failed Sending Notification",level:3},sapi:{event:"API Operation"},fapi:{event:"Failed API Operation"},limit_wc:{event:"Blocked Account",level:4},limit_ui:{event:"Too Many Calls to /userinfo",level:4},api_limit:{event:"Rate Limit On API",level:4},sdu:{event:"Successful User Deletion",level:1},fdu:{event:"Failed User Deletion",level:3}};c.get("/",i),c.post("/",i),e.exports=l.fromExpress(c)}).call(t,n(1).setImmediate)},function(e,t,n){(function(e,i){function o(e,t){this._id=e,this._clearFn=t}var r=n(2).nextTick,s=Function.prototype.apply,a=Array.prototype.slice,l={},c=0;t.setTimeout=function(){return new o(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new o(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,i=arguments.length<2?!1:a.call(arguments,1);return l[n]=!0,r(function(){l[n]&&(i?e.apply(null,i):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof i?i:function(e){delete l[e]}}).call(t,n(1).setImmediate,n(1).clearImmediate)},function(e,t){function n(){c=!1,s.length?l=s.concat(l):u=-1,l.length&&i()}function i(){if(!c){var e=setTimeout(n);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function r(){}var s,a=e.exports={},l=[],c=!1,u=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new o(e,t)),1!==l.length||c||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=r,a.addListener=r,a.once=r,a.off=r,a.removeListener=r,a.removeAllListeners=r,a.emit=r,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t){e.exports=require("auth0@0.8.2")},function(e,t){e.exports=require("useragent")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("express")},function(e,t,n){function i(e){return function(t,n,i){var o=s(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(o,"/"),n.webtaskContext=a(t),e(n,i)}}function o(e){var t;return e.ext("onRequest",function(e,n){var i=s(e.x_wt.jtn);e.setUrl(e.url.replace(i,"/")),e.webtaskContext=t}),function(n,i,o){var r=e._dispatch();t=a(n),r(i,o)}}function r(e){return function(t,n,i){var o=s(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(o,"/"),n.webtaskContext=a(t),e.emit("request",n,i)}}function s(e){var t="^/api/run/[^/]+/",n="(?:[^/?#]*/?)?";return new RegExp(t+(e?n:""))}function a(e){function t(e,t,i){var o=n(8);"function"==typeof t&&(i=t,t={}),i(o.preconditionFailed("Storage is not available in this context"))}function i(t,i,o){var r=n(8),s=n(9);"function"==typeof i&&(o=i,i={}),s({uri:e.secrets.EXT_STORAGE_URL,method:"GET",headers:i.headers||{},qs:{path:t},json:!0},function(e,t,n){return e?o(r.wrap(e,502)):404===t.statusCode&&Object.hasOwnProperty.call(i,"defaultValue")?o(null,i.defaultValue):t.statusCode>=400?o(r.create(t.statusCode,n&&n.message)):void o(null,n)})}function o(e,t,i,o){var r=n(8);"function"==typeof i&&(o=i,i={}),o(r.preconditionFailed("Storage is not available in this context"))}function r(t,i,o,r){var s=n(8),a=n(9);"function"==typeof o&&(r=o,o={}),a({uri:e.secrets.EXT_STORAGE_URL,method:"PUT",headers:o.headers||{},qs:{path:t},body:i},function(e,t,n){return e?r(s.wrap(e,502)):t.statusCode>=400?r(s.create(t.statusCode,n&&n.message)):void r(null)})}return e.read=e.secrets.EXT_STORAGE_URL?i:t,e.write=e.secrets.EXT_STORAGE_URL?r:o,e}t.fromConnect=t.fromExpress=i,t.fromHapi=o,t.fromServer=t.fromRestify=r},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("applicationinsights")}]);